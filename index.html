<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>WavyPrompts</title>
    <link rel="icon" type="image/svg+xml" href="./logo.svg">
    
    <script>
      window.onerror = function(msg, url, line, col, error) {
        if(msg.includes("ResizeObserver")) return;
        const wall = document.getElementById("coming-wall");
        if(wall) wall.style.display = "flex"; // Force wall visible on crash
        
        const errorBox = document.createElement('div');
        errorBox.style.cssText = 'position:fixed; top:0; left:0; width:100%; background:rgba(255,0,0,0.9); color:white; padding:20px; z-index:100000; font-family:monospace; font-size:12px; white-space:pre-wrap;';
        errorBox.innerHTML = '<strong>CRASH DETECTED:</strong><br>' + msg + '<br>Line: ' + line;
        document.body.appendChild(errorBox);
      };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
      window.process = { env: { NODE_ENV: 'production' } };
      window.global = window; 
      
      window.SafeStorage = {
        getItem: (key) => {
          try { return localStorage.getItem(key); } catch (e) { return null; }
        },
        setItem: (key, val) => {
          try { localStorage.setItem(key, val); } catch (e) { }
        }
      };
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Syne:wght@400;500;600;700;800&family=Unbounded:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
      @font-face {
        font-family: 'Milker';
        src: url('./Milker.otf') format('opentype'),
             url('./Milker.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
      }

      html { scroll-behavior: auto; height: 100%; }
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #020202;
        color: #ffffff;
        margin: 0;
        overflow-x: hidden;
        min-height: 100vh;
      }

      ::-webkit-scrollbar { width: 10px; height: 10px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        border: 2px solid transparent;
        background-clip: content-box;
      }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.25); }

      h1, h2, h3, .font-display { font-family: 'Milker', 'Unbounded', 'Syne', sans-serif; }
      
      .glass-panel {
        background: rgba(20, 20, 20, 0.6);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
      }
      
      .glass-input {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        font-family: 'Poppins', sans-serif;
      }

      .glass-element {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      @keyframes marquee-up { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }
      @keyframes marquee-down { 0% { transform: translateY(-50%); } 100% { transform: translateY(0); } }

      .marquee-col { will-change: transform; backface-visibility: hidden; }

      /* ===== COMING SOON WALL ===== */
      .coming-wall {
        position: fixed;
        inset: 0;
        background: #020202;
        z-index: 9999;
        display: flex; /* Visible by default */
        flex-direction: column;
        color: white;
        transition: opacity 0.5s ease-out;
      }
      .cs-header {
        height: 72px;
        margin: 16px;
        border-radius: 999px;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255,255,255,0.08);
        display: flex;
        align-items: center;
        padding: 0 28px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      }
      .cs-brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 800;
        font-size: 22px;
        letter-spacing: -0.02em;
      }
      .cs-brand img { width: 40px; height: 40px; }
      .cs-brand .blue { color: #547EAE; }
      .cs-center {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 0 6vw;
      }
      .cs-center h1 {
        font-family: 'Milker','Unbounded','Syne',sans-serif;
        font-size: clamp(3.5rem, 8vw, 6.8rem);
        line-height: 0.85;
        letter-spacing: -0.08em;
        margin: 0;
        font-weight: 900;
        text-transform: uppercase;
        display: flex;
        flex-direction: column;
      }
      .cs-center .coming {
        margin-top: 40px;
        font-size: 11px;
        letter-spacing: 0.3em;
        opacity: 0.4;
      }
    </style>

    <script>
      (function () {
        const ADMIN_KEY = "wavy_admin";
        const ADMIN_PASSWORD = "uzair2643";
        const params = new URLSearchParams(window.location.search);
        if (params.get("admin") === ADMIN_PASSWORD) {
          window.SafeStorage.setItem(ADMIN_KEY, "1");
          try { window.history.replaceState({}, document.title, window.location.pathname); } catch(e) {}
        }
      })();
    </script>
  </head>
  <body>

    <div id="coming-wall" class="coming-wall">
      <div class="cs-header">
        <div class="cs-brand">
          <img src="./logo.svg" alt="WavyPrompts Logo" />
          <span>Wavy<span class="blue">Prompts</span></span>
        </div>
      </div>
      <div class="cs-center">
        <h1>
          <span>STAY WAVY</span>
          <span>PROMPT</span>
          <span>SMARTER</span>
        </h1>
        <span class="coming">COMING SOON</span>
      </div>
    </div>

    <div id="root"></div>

    <script type="text/babel" data-presets="env,react" data-type="module">
      import React, { useState, useEffect, useRef, useContext, createContext, useMemo } from "https://esm.sh/react@18.2.0";
      import ReactDOM from "https://esm.sh/react-dom@18.2.0/client";
      import { 
        Copy, Share2, Plus, X, ChevronLeft, Image as ImageIcon, 
        MoreHorizontal, Check, Pencil, Search, Sparkles, Loader2, AlertTriangle, Trash2, Upload, Link as LinkIcon, Info, XCircle, CheckCircle2,
        Database, Terminal, Calendar
      } from "https://esm.sh/lucide-react@0.263.1";
      import Lenis from "https://esm.sh/lenis@1.1.14";
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2.39.3";

      const SUPABASE_URL = 'https://wkxmzwvysahrczxbesgk.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndreG16d3Z5c2FocmN6eGJlc2drIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3OTUwMTcsImV4cCI6MjA4MTM3MTAxN30.m7GZaKsWT9KhvAU3dR88cSbVwtK1_FTUM1QL4cf8PN0';
      const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

      // --- TOAST PROVIDER ---
      const ToastContext = createContext(null);
      const ToastProvider = ({ children }) => {
        const [toasts, setToasts] = useState([]);
        const addToast = (message, type = 'success') => {
          const id = Date.now();
          setToasts(prev => [...prev, { id, message, type }]);
          setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 4000);
        };
        return (
          <ToastContext.Provider value={{ addToast }}>
            {children}
            <div className="fixed bottom-6 left-1/2 -translate-x-1/2 md:translate-x-0 md:left-auto md:bottom-6 md:right-6 z-[200] flex flex-col gap-3 pointer-events-none w-full max-w-[calc(100%-32px)] md:max-w-sm">
              {toasts.map(toast => (
                <div key={toast.id} className="pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-xl border backdrop-blur-md shadow-2xl bg-[#1a1a1a]/90 border-white/10 text-white animate-in slide-in-from-bottom-5 fade-in">
                  <span className="text-[#547EAE]"><CheckCircle2 size={20} /></span>
                  <p className="text-sm font-medium">{toast.message}</p>
                </div>
              ))}
            </div>
          </ToastContext.Provider>
        );
      };
      const useToast = () => useContext(ToastContext);

      // --- HERO SECTION ---
      const HeroSection = ({ prompts }) => {
        const cols = useMemo(() => {
          const pool = prompts && prompts.length > 0 ? prompts : Array.from({length: 8}).fill(null);
          const items = [...pool, ...pool].slice(0, 18); 
          const result = [[], [], [], [], [], []];
          items.forEach((item, i) => { result[i % 6].push(item); });
          return result;
        }, [prompts]);

        return (
          <div className="relative w-full h-[400px] md:h-[480px] rounded-[32px] overflow-hidden mb-12 border border-white/10 shadow-2xl bg-[#0a0a0a]">
              <div className="absolute inset-[-100px] opacity-70 flex gap-4 justify-center items-start transform -rotate-6 scale-110 pointer-events-none select-none">
                  {cols.map((colItems, colIndex) => (
                      <div key={colIndex} className="marquee-col flex flex-col gap-4 w-1/3 sm:w-1/4 md:w-1/6 shrink-0"
                        style={{ animation: `${colIndex % 2 === 0 ? 'marquee-up' : 'marquee-down'} ${40 + (colIndex * 5)}s linear infinite` }}>
                          {colItems.map((p, i) => (
                              <div key={i} className="w-full aspect-[4/5] rounded-xl bg-gray-800/50 overflow-hidden border border-white/5 relative">
                                 <img src={p ? p.imageUrl : `https://picsum.photos/seed/${colIndex * 100 + i}/400/500`} className="w-full h-full object-cover" loading="lazy" />
                              </div>
                          ))}
                      </div>
                  ))}
              </div>
              <div className="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
              <div className="absolute inset-0 flex flex-col items-start justify-end z-10 p-8 pb-12 md:pb-16 text-left">
                    <h1 className="font-display font-black text-3xl md:text-5xl tracking-tighter leading-[0.85] text-white drop-shadow-2xl flex flex-col gap-0 md:gap-1">
                      <span>STAY WAVY</span>
                      <span className="text-white/90">PROMPT SMARTER</span>
                    </h1>
              </div>
          </div>
        );
      };

      // --- MAIN APP ---
      const MainApp = () => {
        const [prompts, setPrompts] = useState([]);
        const [view, setView] = useState('gallery');

        useEffect(() => {
          // --- WALL LOGIC: Only hide if Admin ---
          const isAdmin = window.SafeStorage.getItem("wavy_admin") === "1";
          const isShared = window.location.hash.startsWith('#/share/');
          
          if (isAdmin || isShared) {
            const wall = document.getElementById('coming-wall');
            if(wall) wall.style.display = 'none'; // Reveal App
          }
        }, []);

        useEffect(() => {
          const fetchPrompts = async () => {
            const { data } = await supabase.from('prompts').select('*').order('created_at', { ascending: false });
            if(data) setPrompts(data.map(p => ({...p, imageUrl: p.image_url})));
          };
          fetchPrompts();
        }, []);

        return (
          <div className="min-h-screen relative text-white pt-24 pb-20 px-4 md:px-6 z-10 relative max-w-7xl mx-auto">
             <HeroSection prompts={prompts} />
             {/* Simple Prompt Grid */}
             <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                {prompts.map(p => (
                  <div key={p.id} className="aspect-[4/5] bg-gray-800 rounded-xl overflow-hidden border border-white/10">
                    <img src={p.imageUrl} className="w-full h-full object-cover" />
                  </div>
                ))}
             </div>
          </div>
        );
      };

      const App = () => <ToastProvider><MainApp /></ToastProvider>;
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>